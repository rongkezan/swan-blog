---
title: Dubbo
date: {{ date }}
categories:
- 开发集
---

## Dubbo 核心功能

- 远程方法调用

  网络通信框架，提供对多种NIO框架抽象封装，包括“同步转异步”和“请求-响应”模式的信息交换方式。

- 智能容错和负载均衡

  提供基于接口方法的透明远程过程调用，包括多协议支持，以及软负载均衡，失败容错，地址路由，动态配置等集群支持。

- 服务注册和发现

  服务注册，基于注册中心目录服务，使服务消费方能动态的查找服务提供方，使地址透明，使服务提供方可以平滑增加或减少机器。

## Dubbo 核心组件

![img](https://img-blog.csdnimg.cn/img_convert/9378e2b3cfbde0a372cf6758e5a09962.png)

## Dubbo 长连接

Dubbo长连接是指在服务消费者和服务提供者之间建立一条长时间保持的TCP连接。在这种连接下，服务消费者可以通过该连接向服务提供者发送多个RPC请求和响应，而不必每次请求都建立一个新的TCP连接，从而降低了网络开销和连接建立的时间成本。

在Dubbo中，长连接是由客户端通过连接池来管理的。客户端维护了一个连接池，用于存放多个TCP连接对象，当客户端需要向服务提供者发送RPC请求时，可以从连接池中获取一个已经建立好的连接，发送请求后并不会关闭这个连接，而是将其归还给连接池，以备后续使用。这种方式可以避免重复建立和关闭连接所带来的网络开销和资源浪费，从而提升了Dubbo的性能和稳定性。

同时，Dubbo长连接还支持心跳机制，服务消费者和服务提供者可以通过定期发送心跳消息来维持连接的活跃状态，从而防止连接被中断。当客户端在一定时间内没有向服务端发送任何消息时，服务端会主动关闭连接，以释放网络资源。这种方式可以有效地减少因网络闲置而导致的资源浪费，提高系统的可用性。

总之，Dubbo长连接可以有效地提高Dubbo框架的性能和稳定性，减少网络开销和连接建立的时间成本，同时通过心跳机制来保持连接的活跃状态，提高系统的可用性。

## Dubbo 调用流程

![img](https://img-blog.csdnimg.cn/img_convert/5bdb46be37f781d0e3e4693341114db0.png)

1. 服务提供者启动，开启Netty服务，创建Zookeeper客户端，向注册中心注册服务；
2. 服务消费者启动，通过Zookeeper向注册中心获取服务提供者列表，与服务提供者通过Netty建立长连接；
3. 服务消费者通过接口开始远程调用服务，ProxyFactory通过初始化Proxy对象，Proxy通过创建动态代理对象；
4. 动态代理对象通过invoke方法，层层包装生成一个Invoker对象，该对象包含了代理对象；
5. Invoker通过路由，负载均衡选择了一个最合适的服务提供者，在通过加入各种过滤器，协议层包装生成一个新的DubboInvoker对象；
6. 再通过交换成将DubboInvoker对象包装成一个Reuqest对象，该对象通过序列化通过NettyClient传输到服务提供者的NettyServer端；
7. 到了服务提供者这边，再通过反序列化、协议解密等操作生成一个DubboExporter对象,再层层传递处理,会生成一个服务提供端的Invoker对象；
8. 这个Invoker对象会调用本地服务，获得结果再通过层层回调返回到服务消费者，服务消费者拿到结果后，再解析获得最终结果。